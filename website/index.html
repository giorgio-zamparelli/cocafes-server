<!DOCTYPE html>
<html>
<head>
    <style type="text/css">

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #map {
            height: 100%;
        }

        .viewInGoogleMaps {
            color:#427fed;
            text-decoration: none;
        }

        .viewInGoogleMaps:hover {
            text-decoration: underline;
        }

    </style>

    <script>

        var venuesInit = JSON.parse(`<%-JSON.stringify(venues)%>`);

    </script>

</head>
<body>

    <div id="map"></div>

    <script type="text/javascript">

        var map;
        function initMap() {

            'use strict';

            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 18.79646, lng: 98.9723142},
                zoom: 15
            });

            for (let venue of venuesInit) {

                if (venue && venue.location && venue.location.coordinates && venue.location.coordinates.length > 1) {

                    let icon = venue.wifis && venue.wifis.length > 0 ? "http://maps.google.com/mapfiles/ms/icons/green-dot.png" : "http://maps.google.com/mapfiles/ms/icons/red-dot.png";

                    let marker = new google.maps.Marker({
                        position: {lat: venue.location.coordinates[1], lng: venue.location.coordinates[0]},
                        map: map,
                        title: venue.name,
                        icon: icon

                    });

                    let googleMapsUrl;

                    if (venue.googlePlaceCid) {
                        googleMapsUrl = "https://maps.google.com/?cid=" + venue.googlePlaceCid;
                    } else {
                        googleMapsUrl = "https://www.google.com/maps/place/" + venue.name.split(" ").join("+");
                    }

                    let infowindow = new google.maps.InfoWindow({
                        content: `
                            <div>${venue.name}</div>
                            </br>
                            <div><a class="viewInGoogleMaps" href="${googleMapsUrl}" target="_blank">View on Google Maps</a></div>
                        `
                    });

                    marker.addListener('click', function() {
                        infowindow.open(map, marker);
                    });

                }

            }

        }

    </script>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDsmiYX2EzjgLKKUubxcNLXgweqP7uWmOc&callback=initMap">
    </script>

  </body>
</html>
